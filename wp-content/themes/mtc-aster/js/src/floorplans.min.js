!function(){"use strict";var t,e,n,a,i,o=$("#checkboxes"),r=$("#checkboxes-container"),l=null,s=[],u=!1,d=!1,c=$("#mobile-label"),f=$("#mobile-category-overlay"),h=$("#search-form"),p=h.find("input"),m="ALL",v=new Date,g=$("#unit-detail"),b=g.find("img"),y=$("#unit-detail-wrapper"),R=null,x=[],k=[],P="3031826";function F(t){return void 0!==t}function w(t){return void 0!=typeof t&&null!=t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):""}function A(){var n;return n=p.serializeArray(),k=[],$.map(n,function(t,e){var n=t.name.replace("[]","");void 0===k[n]&&(k[n]=[]),k[n].push(t.value)}),t=new Date(k["move-in-date"][0]),console.log(t),t.getTime()!=e?(e=t.getTime(),function(){$("#results-table").html(""),$("#loader").fadeIn();var e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();console.log(e),$.ajax({cache:!1,url:"/realPageAPIunitsJSON.php?date="+e,dataType:"json",success:function(t){R=t,console.log("units from PHP",R),null!=l&&q()}})}()):C(),!1}function D(t){var n=new Date(t);return(n=n.getTime()<i?i:n.getTime())<=e}function I(t){""!=t&&(t="#"+t);var e=floorPlansURL+t;$("#share-buttons span").each(function(){var t=$(this).attr("st_url");void 0!==t&&!1!==t&&$(this).attr("st_url",e)}),document.location.hash=t}function U(t){if(F(k["unit-type"])&&""!=k["unit-type"][0]&&"0"!=k["unit-type"][0]&&F(t.FloorPlanGroupName)){for(var e=!1,n=0;n<k["unit-type"].length;n++){var a=k["unit-type"][n];for(var i in x[a])x[a][i]==t.FloorPlanGroupName&&(e=!0)}if(!e)return!1}if(F(t.units)){for(var o=[],r=0;r<t.units.length;r++){var l=t.units[r],s=!0;F(l.Availability.MadeReadyDate)?(s=D(l.Availability.MadeReadyDate),F(k["max-rent"])&&""!=k["max-rent"][0]&&F(l.BaseRentAmount)&&parseInt(l.BaseRentAmount)>=k["max-rent"][0]&&(s=!1)):s=!1,o.push(s)}for(i=0;i<o.length;i++)if(o[i])return!0}return!1}function N(e){console.log("unit",e);var n=F(e.Address)&&F(e.Address.UnitNumber)?e.Address.UnitNumber:"",a=$("#move-in-date").val(),i=F(e.BaseRentAmount)?w(parseInt(e.BaseRentAmount)):"",o=F(e.UnitDetails)&&F(e.UnitDetails.RentSqFtCount)?e.UnitDetails.RentSqFtCount:"",r=F(e.Address)&&F(e.Address.UnitID)?e.Address.UnitID:"",l=$("#available-unit-template").clone();if(F(n)&&("0"==n.substring(0,1)&&(n=n.substring(1)),l.attr({id:"unit-"+n}),l.find(".apt span").html(n),l.css("display","block")),F(i)&&l.find(".rent span").html("$"+i),F(o)&&l.find(".sqft span").html(w(o)),F(r)){if(0==a.length){var s=t.getDate(),u=t.getMonth()+1,d=t.getFullYear();s<10&&(s="0"+s),u<10&&(u="0"+u),a=u+"/"+s+"/"+d}if("undefined"!=typeof leaseOnlineURL){var c=F(r)?leaseOnlineURL+"?MoveInDate="+a+"&UnitId="+r+"&site_id="+P+"&SearchUrl="+document.location:"";l.find(".availability a").attr("href",c),l.find(".availability a").attr({"data-unit-type":e.FloorPlan.FloorPlanName,"data-unit-number":n,"data-unit-type-category":e.UnitDetails.Bedrooms+" Bed"})}}return l}function B(){var t=g.find(".left"),e=t.height(),n=t.width();b.css({"max-height":e,"max-width":n})}function L(t){var e=t.unitsAvailable,n=$("#available-units"),a=[],i=t.Bathrooms,o=t.Bedrooms,r=t.FloorPlanID,l=t.FloorPlanName,s=t.RentMin!=t.RentMax?w(parseInt(t.RentMin))+" - "+w(parseInt(t.RentMax)):w(parseInt(t.RentMax)),u=t.RentableSquareFootage,c=t.FloorPlanGroupName;if(I(r),d=!0,F(l)){var f=l.toUpperCase();g.find("img").attr("src",templateURL+"/images/floorplans/"+f+".png"),$("#unit-pdf-link").attr("href",templateURL+"/pdf/"+f+".pdf"),g.find(".name").html(l)}if(F(o)){var h=o>0?"<span>"+o+"</span> Bed":"Studio";F(c)&&""!=((c=c.toLowerCase()).indexOf("den")>-1?"Den":"")&&(h+=" with Den"),g.find(".beds").html(h)}if(F(i)&&g.find(".baths span").html(i),F(u)&&g.find(".sqft span").html(w(u)),F(s)&&g.find(".rent span").html("$"+s),h=h.replace(/<\/?[^>]+(>|$)/g,""),$("#unit-pdf-link").attr({"data-unit-type":l,"data-unit-type-category":h}),g.find(".available-count span").html(e),n.html(""),F(t.units)&&e>0){for(var p=0;p<t.units.length;p++){var m=N(t.units[p]);a.push(m[0])}n.append(a).show()}else n.hide();y.fadeIn(function(){B(),$("html,body").animate({scrollTop:0},250)}),$("#unit-detail-background").fadeIn()}function M(t){var e=t.unitsAvailable,n=t.Bathrooms,a=t.Bedrooms,i="",o=t.FloorPlanName,r=t.RentMin!=t.RentMax?w(parseInt(t.RentMin))+" - "+w(parseInt(t.RentMax)):w(parseInt(t.RentMax)),l=t.RentableSquareFootage,s=t.FloorPlanGroupName,u=$("#result-template").clone();if(F(s)&&(s=s.toLowerCase(),u.attr({id:"unit-type-"+o,class:"unit-type-tr"}),u.find(".name").html(o),i=s.indexOf("den")>-1?"Den":""),F(a)){var d=a>0?a+" Bed":"Studio";F(n)&&n>0&&(d+=" / "+n+" Bath"),u.find(".bedbath").html(d)}return""!=i&&u.find(".den").html(i),F(l)&&u.find(".sqft").html(w(l)),F(r)&&u.find(".rent").html("$"+r),e>0&&u.find(".availability").html(e+" Available"),u.find("button").attr({"data-unit-type":o}),u.find("button").attr({"data-unit-type-category":d}),u.find("button").on({click:function(){L(t)}}),u}function C(){var t=!1,e=!1,a=!0,i=$("#results-table"),o=$("#results"),r=$("#no-results"),s=[];i.html(" "),n.length>0&&(t=!0);for(var d in l){if(t&&l[d].FloorPlanID==n&&(L(l[d]),e=!0),!1!==U(l[d])){var c=M(l[d]);s.push(c[0]),e=!0}a&&($("#loader").fadeOut(),a=!1)}e?(r.length&&r.hide(),o.fadeIn(),$.fn.append.apply(i,s).html(),u?$("#results").trigger("update"):($("#results").tablesorter({sortList:[[0,0]]}),u=!0)):(o.hide(),r.length&&r.fadeIn())}function O(t,e){var n,a,i=x[t][0],r=$(document.createElement("input")),l=$(document.createElement("div")),s=$(document.createElement("label")),u="checkbox-container",d=i.split("/"),h=i.replace(/\//g,"-");if(r.attr({id:h,type:"radio",name:"unit-type",value:t}),e&&(r.attr({checked:"checked"}),l.addClass("active")),r.on({click:function(){o.find(".checkbox-container").removeClass("active"),l.addClass("active"),f.is(":visible")&&(o.find("input").not(this).attr("checked",!1),f.trigger("click"),c.hide(),$(".checkbox-container").removeClass("active"),$(this).is(":checked")?$(this).parent(".checkbox-container").addClass("active"):c.show()),m=i}}),s.html((n=i.toLowerCase(),a=["zero","one","two","three","four","five","six","seven","eight","nine"][n.substring(0,1)],n.indexOf("eff")>-1?a="Studio":n.indexOf("1bd")>-1?a="1BR":n.indexOf("2bd")>-1?a="2BR":n.indexOf("3bd")>-1?a="3BR":n.indexOf("all")>-1&&(a="All"),a)),s.attr({for:h}),d.length>0){var p="type-"+function(t){switch(t){case"eff":return"studio";default:return t}}(d[0].toLowerCase());u+=" "+p,s.addClass(p)}return l.addClass(u),l.append(r,s),l}function S(){o.html("");var t=[];x.unshift(["ALL"]);for(var e in x)if(x[e].length>0){var n=O(e,m==x[e][0]);t.push(n[0])}o.append(t),(p=h.find("input")).unbind("change keyup paste"),p.on("change keyup paste",function(){A()})}function T(t){for(var e=[],n=0;n<R.length;n++)void 0!==R[n].FloorPlan&&void 0!==R[n].FloorPlan.FloorPlanName&&R[n].FloorPlan.FloorPlanName==t&&e.push(R[n]);return e}function j(){for(var t=0;t<l.length;t++)if(void 0!==l[t].FloorPlanID){var e=l[t].FloorPlanName,n=T(e),a=0;if(n.length>0)for(var i=0;i<n.length;i++)void 0!==n[i].Availability.MadeReadyDate&&D(n[i].Availability.MadeReadyDate)&&(a+=1);l[t].unitsAvailable=a,l[t].units=n,void 0===s[e]&&(s[e]=l[t])}!function(){for(var t in s)if(void 0!==s[t].FloorPlanGroupName){var e=s[t].FloorPlanGroupName,n=e.toLowerCase().substring(0,1);switch(n){case"e":n=0;break;default:n=parseInt(n)}void 0===x[n]&&(x[n]=[]),$.inArray(e,x[n])<0&&void 0!==s[t].units&&s[t].units.length>0&&x[n].push(e)}S()}(),C()}function q(){s=[],x=[],j()}function G(){h.on({submit:function(){return A()}}),$("#unit-detail-background,#unit-detail-close-button").on({click:function(){$("#unit-detail-background").fadeOut(),$("#unit-detail-wrapper").fadeOut(),I(""),d=!1}}),$("#share-button,#share-close-button,#share-info-background").on({click:function(){$("#share-info-wrapper").fadeToggle()}}),f.on("click",function(){r.toggleClass("show")})}v.setHours(0,0,0,0),i=v.getTime(),$(document).ready(function(){n=window.location.hash.replace("#",""),$.ajax({cache:!1,url:templateURL+"/JSON/realPageFloorPlans.json",dataType:"json",success:function(t){l=t,null!=R&&q()}}),$.ajax({cache:!1,url:templateURL+"/JSON/realPageUnits.json",dataType:"json",success:function(t){R=t,console.log("units from JSON",R),null!=l&&q()}}),(a=new Date($("#move-in-date").val())).getTime()<i?a=v:v=a,e=a.getTime(),G(),$("#move-in-date").datepicker({minDate:a})}),$(window).on({load:function(){d&&B()},resize:function(){var t,e,n;d&&(B(),t=g.find(".left img").outerHeight()+20,e=g.find(".right").outerHeight(),(n=t>e?t:e)>600?y.css("height",n):y.css("height",""))},scroll:function(){}})}();